window.vapidPublicKey = new Uint8Array(<%= Base64.urlsafe_decode64( Rails.application.secrets[:webpush][:public_key]).bytes %>);

// Register the serviceWorker script at /serviceworker.js from your server if supported
if (navigator.serviceWorker) {
    navigator.serviceWorker.register('/serviceworker.js')
        .then(function (reg) {
            console.log('Service worker change, registered the service worker');
        });

    navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {
        serviceWorkerRegistration.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: window.vapidPublicKey
        }).then(function(subscription) {
            console.log(subscription);
        });
    });
} else {
    console.error('Service worker is not supported in this browser');
}
